<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin</title>
</head>
<body>
    <h2>Administraci√≥n</h2>

<div>
  <h3>Editar TablaMVP</h3>
  <select id="selectJugador"></select>
  <label>Goles: <input type="number" id="inputG" min="0" value="0"></label>
  <label>Asistencias: <input type="number" id="inputA" min="0" value="0"></label>
  <label>Tarjetas: <input type="number" id="inputT" min="0" value="0"></label>
  <label>Victorias: <input type="number" id="inputV" min="0" value="0"></label>
  <button id="guardarJugador">Guardar</button>
</div>

<div>
  <h3>Editar Resultados</h3>
  <select id="selectEquipo"></select>
  <label>PJ: <input type="number" id="inputPJ" min="0" value="0"></label>
  <label>PG: <input type="number" id="inputPG" min="0" value="0"></label>
  <label>PE: <input type="number" id="inputPE" min="0" value="0"></label>
  <label>PP: <input type="number" id="inputPP" min="0" value="0"></label>
  <label>GF: <input type="number" id="inputGF" min="0" value="0"></label>
  <label>GC: <input type="number" id="inputGC" min="0" value="0"></label>
  <button id="guardarEquipo">Guardar</button>
</div>

<script>
  let datos = null;

  async function cargarDatos() {
    const res = await fetch('/api/datos');
    datos = await res.json();
    llenarSelects();
  }

  function llenarSelects() {
    const selJ = document.getElementById('selectJugador');
    selJ.innerHTML = '';
    for (const nombre in datos.jugadores) {
      const opt = document.createElement('option');
      opt.value = nombre;
      opt.textContent = nombre;
      selJ.appendChild(opt);
    }
    cargarJugador(selJ.value);

    const selE = document.getElementById('selectEquipo');
    selE.innerHTML = '';
    for (const nombre in datos.equipos) {
      const opt = document.createElement('option');
      opt.value = nombre;
      opt.textContent = nombre;
      selE.appendChild(opt);
    }
    cargarEquipo(selE.value);
  }

  function cargarJugador(nombre) {
    const j = datos.jugadores[nombre];
    document.getElementById('inputG').value = j.g;
    document.getElementById('inputA').value = j.a;
    document.getElementById('inputT').value = j.t;
    document.getElementById('inputV').value = j.v;
  }

  function cargarEquipo(nombre) {
    const e = datos.equipos[nombre];
    document.getElementById('inputPJ').value = e.pj;
    document.getElementById('inputPG').value = e.pg;
    document.getElementById('inputPE').value = e.pe;
    document.getElementById('inputPP').value = e.pp;
    document.getElementById('inputGF').value = e.gf;
    document.getElementById('inputGC').value = e.gc;
  }

  document.getElementById('selectJugador').addEventListener('change', e => {
    cargarJugador(e.target.value);
  });

  document.getElementById('selectEquipo').addEventListener('change', e => {
    cargarEquipo(e.target.value);
  });

  document.getElementById('guardarJugador').addEventListener('click', async () => {
    const nombre = document.getElementById('selectJugador').value;
    datos.jugadores[nombre] = {
      equipo: datos.jugadores[nombre].equipo,
      g: Number(document.getElementById('inputG').value),
      a: Number(document.getElementById('inputA').value),
      t: Number(document.getElementById('inputT').value),
      v: Number(document.getElementById('inputV').value),
    };
    await guardarDatos();
  });

  document.getElementById('guardarEquipo').addEventListener('click', async () => {
    const nombre = document.getElementById('selectEquipo').value;
    datos.equipos[nombre] = {
      pj: Number(document.getElementById('inputPJ').value),
      pg: Number(document.getElementById('inputPG').value),
      pe: Number(document.getElementById('inputPE').value),
      pp: Number(document.getElementById('inputPP').value),
      gf: Number(document.getElementById('inputGF').value),
      gc: Number(document.getElementById('inputGC').value),
    };
    await guardarDatos();
  });

  async function guardarDatos() {
    const res = await fetch('/api/datos', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(datos),
    });
    if (res.ok) {
      alert('Datos guardados y actualizados!');
    } else {
      alert('Error guardando datos');
    }
  }

  cargarDatos();
</script>

</body>
</html>